<%# Notification partial - use via showNotification() %>
<div id="toast-container" class="fixed top-4 right-4 z-[9999] flex flex-col gap-3 pointer-events-none sm:max-w-sm w-full p-4 sm:p-0"></div>

<style>
  .toast-animate-in {
    animation: toastEnter 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards;
  }
  .toast-animate-out {
    animation: toastExit 0.3s cubic-bezier(0.4, 0, 1, 1) forwards;
  }
  
  @keyframes toastEnter {
    0% { 
      opacity: 0; 
      transform: translate3d(100%, 0, 0) scale(0.95);
    }
    100% { 
      opacity: 1; 
      transform: translate3d(0, 0, 0) scale(1);
    }
  }
  
  @keyframes toastExit {
    0% { 
      opacity: 1; 
      transform: translate3d(0, 0, 0) scale(1);
      max-height: 200px;
    }
    100% { 
      opacity: 0; 
      transform: translate3d(120%, 0, 0) scale(0.9);
      max-height: 0;
      margin-top: 0;
      margin-bottom: 0;
      padding-top: 0;
      padding-bottom: 0;
    }
  }
  
  @keyframes iconBounce {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.1); }
  }
  
  @keyframes progressBar {
    from { transform: scaleX(1); }
    to { transform: scaleX(0); }
  }
  
  .toast-icon-animate {
    animation: iconBounce 0.5s cubic-bezier(0.16, 1, 0.3, 1);
  }
  
  .toast-progress {
    animation: progressBar linear forwards;
    transform-origin: left;
  }
</style>

<script>
  window.showNotification = function (message, type = "info", duration = 4000) {
    let container = document.getElementById("toast-container");
    if (!container) {
      container = document.createElement("div");
      container.id = "toast-container";
      container.className = "fixed top-4 right-4 z-[9999] flex flex-col gap-3 pointer-events-none sm:max-w-sm w-full p-4 sm:p-0";
      document.body.appendChild(container);
    }

    // Normalize type
    if (type === "warning") type = "warn";

    // Enhanced modern styles configuration
    const styles = {
      success: {
        wrapper: "bg-gradient-to-br from-white to-green-50/30 border-green-200/60 shadow-xl shadow-green-100/50",
        iconWrapper: "bg-gradient-to-br from-green-500 to-green-600 text-white shadow-lg shadow-green-500/30",
        titleColor: "text-gray-900",
        progressBar: "bg-gradient-to-r from-green-500 to-green-600",
        icon: '<svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7.75 12.75L10 15.25L16.25 8.75" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/></svg>'
      },
      error: {
        wrapper: "bg-gradient-to-br from-white to-red-50/30 border-red-200/60 shadow-xl shadow-red-100/50",
        iconWrapper: "bg-gradient-to-br from-red-500 to-red-600 text-white shadow-lg shadow-red-500/30",
        titleColor: "text-gray-900",
        progressBar: "bg-gradient-to-r from-red-500 to-red-600",
        icon: '<svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/></svg>'
      },
      warn: {
        wrapper: "bg-gradient-to-br from-white to-amber-50/30 border-amber-200/60 shadow-xl shadow-amber-100/50",
        iconWrapper: "bg-gradient-to-br from-amber-500 to-amber-600 text-white shadow-lg shadow-amber-500/30",
        titleColor: "text-gray-900",
        progressBar: "bg-gradient-to-r from-amber-500 to-amber-600",
        icon: '<svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 9V11M12 15H12.01M5.0718 19H18.9282C19.9693 19 20.6202 17.8729 20.0998 16.9715L13.1716 4.9715C12.6512 4.0701 11.3488 4.0701 10.8284 4.9715L3.90016 16.9715C3.37978 17.8729 4.03071 19 5.0718 19Z" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/></svg>'
      },
      info: {
        wrapper: "bg-gradient-to-br from-white to-blue-50/30 border-blue-200/60 shadow-xl shadow-blue-100/50",
        iconWrapper: "bg-gradient-to-br from-blue-500 to-blue-600 text-white shadow-lg shadow-blue-500/30",
        titleColor: "text-gray-900",
        progressBar: "bg-gradient-to-r from-blue-500 to-blue-600",
        icon: '<svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M13 16H12V12H11M12 8H12.01M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/></svg>'
      }
    };

    const style = styles[type] || styles.info;

    const toast = document.createElement("div");
    toast.className = `pointer-events-auto relative overflow-hidden rounded-2xl border-2 backdrop-blur-xl toast-animate-in group ${style.wrapper}`;
    
    toast.innerHTML = `
      <div class="flex items-start gap-3.5 p-4">
        <div class="flex-shrink-0 flex items-center justify-center w-10 h-10 rounded-xl toast-icon-animate ${style.iconWrapper}">
          ${style.icon}
        </div>
        <div class="flex-1 pt-1 min-w-0 pr-2">
          <p class="text-sm font-semibold leading-5 tracking-tight ${style.titleColor}">${message}</p>
        </div>
        <button type="button" class="flex-shrink-0 -mt-0.5 -mr-0.5 p-2 rounded-lg text-gray-400 hover:text-gray-700 hover:bg-gray-100/80 active:bg-gray-200/80 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-gray-300 opacity-60 group-hover:opacity-100">
          <span class="sr-only">Close</span>
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M6 18L18 6M6 6l12 12" /></svg>
        </button>
      </div>
      ${duration > 0 ? `<div class="absolute bottom-0 left-0 right-0 h-1 bg-gray-200/30 overflow-hidden">
        <div class="h-full toast-progress ${style.progressBar}" style="animation-duration: ${duration}ms;"></div>
      </div>` : ''}
    `;

    // Close Logic with pause on hover
    let timeoutId;
    let isPaused = false;
    
    const close = () => {
      if (timeoutId) clearTimeout(timeoutId);
      
      toast.classList.remove("toast-animate-in");
      toast.classList.add("toast-animate-out");
      
      setTimeout(() => {
        toast.remove();
      }, 300);
    };

    const closeButton = toast.querySelector("button");
    if (closeButton) {
      closeButton.addEventListener("click", close);
    }
    
    // Pause progress bar on hover
    if (duration > 0) {
      const progressBar = toast.querySelector(".toast-progress");
      
      toast.addEventListener("mouseenter", () => {
        isPaused = true;
        if (timeoutId) clearTimeout(timeoutId);
        if (progressBar) {
          progressBar.style.animationPlayState = "paused";
        }
      });
      
      toast.addEventListener("mouseleave", () => {
        if (isPaused) {
          isPaused = false;
          if (progressBar) {
            progressBar.style.animationPlayState = "running";
            // Calculate remaining time based on progress
            const computedStyle = window.getComputedStyle(progressBar);
            const transform = computedStyle.transform;
            const matrix = new DOMMatrix(transform);
            const remainingRatio = matrix.m11; // scaleX value
            const remainingTime = duration * remainingRatio;
            
            if (remainingTime > 100) {
              timeoutId = setTimeout(close, remainingTime);
            } else {
              close();
            }
          }
        }
      });
    }

    container.appendChild(toast);
    
    if (duration > 0) {
      timeoutId = setTimeout(close, duration);
    }
  };
</script>