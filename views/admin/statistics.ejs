<%- layout('layouts/main') %>
<div class="container mx-auto px-4 py-8">
  <h1 class="text-3xl font-bold mb-6 text-gray-800"><%= title %></h1>

  <!-- Filters -->
  <div class="bg-white p-6 rounded-lg shadow-md mb-6">
    <h2 class="text-2xl font-semibold mb-4 text-gray-700">Filtry</h2>
    
    <form class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <!-- User Filter -->
      <div>
        <label for="user_id" class="block text-sm font-medium text-gray-700 mb-1">Pracownik</label>
        <select id="user_id" name="user_id" class="w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200 focus:ring-opacity-50 p-1.5">
          <% users.forEach(user => { %>
            <option value="<%= user.id %>" <%= selectedUserId === user.id ? 'selected' : '' %>><%= user.email %></option>
          <% }); %>
        </select>
      </div>
      
      <!-- Month Filter -->
      <div>
        <label for="month" class="block text-sm font-medium text-gray-700 mb-1">Miesiąc</label>
        <select id="month" name="month" class="w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200 focus:ring-opacity-50 p-1.5">
          <% months.forEach(month => { %>
            <option value="<%= month.value %>" <%= selectedMonth === month.value ? 'selected' : '' %>><%= month.name %></option>
          <% }); %>
        </select>
      </div>
      
      <!-- Year Filter -->
      <div>
        <label for="year" class="block text-sm font-medium text-gray-700 mb-1">Rok</label>
        <select id="year" name="year" class="w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-200 focus:ring-opacity-50 p-1.5">
          <% for (let year = new Date().getFullYear(); year >= 2022; year--) { %>
            <option value="<%= year %>" <%= selectedYear === year ? 'selected' : '' %>><%= year %></option>
          <% } %>
        </select>
      </div>
    </form>
  </div>

  <!-- Calendar View -->
  <% if (workData.length > 0 && selectedUser) { %>
    <div class="bg-white p-6 rounded-lg shadow-md mb-6">
      <h2 class="text-2xl font-semibold mb-4 text-gray-700">
        Godziny pracy: <%= selectedUser.email %>
      </h2>
      <h3 class="text-lg font-medium text-gray-600 mb-6">
        <%= months.find(m => m.value === selectedMonth).name %> <%= selectedYear %>
      </h3>
      
      <div class="w-fit">
        <div class="grid grid-cols-7 gap-1">
          <!-- Day boxes -->
          <% workData.forEach(day => { %>
            <div class="relative min-w-[90px] w-full aspect-square rounded-lg border <%= day.hours > 0 ? 'border-blue-500 bg-blue-50' : 'border-gray-300' %> flex flex-col items-center justify-center shadow-sm hover:shadow-md transition-shadow p-1">
              <!-- Day number (small, top right) -->
              <span class="absolute top-0 right-0.5 text-sm text-gray-500"><%= day.day %></span>
              
              <!-- Weekday name (small, bottom left) -->
              <span class="absolute bottom-0 left-0.5 text-xs text-gray-400 mb-0.5">
                <% 
                  const date = new Date(day.date);
                  const weekdayAbbr = getDayOfWeekAbbr(day.date);
                %>
                <%= weekdayAbbr %>
              </span>
              
              <!-- Hours (center, large) -->
              <span class="text-base font-bold <%= day.hours > 0 ? 'text-blue-500' : 'text-gray-400' %>">
                <%= day.hours > 0 ? day.hours : '-' %>
              </span>
              
              <!-- Label for hours -->
              <span class="text-xs text-gray-500">
                <%= day.hours === 1 ? 'h' : 'h' %>
              </span>
              
              <!-- Holiday or Public Holiday information -->
              <% if (day.isPublicHoliday) { %>
                <span class="text-xs text-blue-600 mt-1">święto</span>
              <% } else if (day.isHoliday) { %>
                <span class="text-xs text-green-600 mt-1">urlop</span>
              <% } %>
            </div>
          <% }); %>
        </div>
      </div>
      
      <!-- Monthly Summary -->
      <div class="mt-8">
        <h3 class="text-xl font-semibold text-gray-700 mb-4">Podsumowanie miesiąca</h3>
        <div class="flex flex-col sm:flex-row gap-4">
          <!-- Przepracowane godziny -->
          <div class="flex-1 bg-blue-50 p-4 rounded-lg shadow-sm border border-blue-100">
            <p class="text-sm text-blue-600 mb-1 text-center">Przepracowane godziny</p>
            <p class="text-2xl font-bold text-blue-800 text-center">
              <%= workData.reduce((total, day) => total + day.hours, 0) %>
            </p>
          </div>
          <!-- Wszystkie godziny -->
          <div class="flex-1 bg-green-50 p-4 rounded-lg shadow-sm border border-green-100">
            <p class="text-sm text-green-600 mb-1 text-center">Wszystkie godziny</p>
            <p class="text-2xl font-bold text-green-800 text-center">
              <%= totalCombinedHours %>
            </p>
          </div>
        </div>
      </div>
    </div>
  <% } else if (selectedUserId) { %>
    <div class="bg-white p-6 rounded-lg shadow-md">
      <p class="text-gray-600">Nie znaleziono danych dla wybranego pracownika i miesiąca.</p>
    </div>
  <% } else { %>
    <div class="bg-white p-6 rounded-lg shadow-md">
      <p class="text-gray-600">Wybierz pracownika, aby wyświetlić statystyki.</p>
    </div>
  <% } %>
</div>

<!-- JavaScript for auto-submit on filter change -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const filterForm = document.querySelector('form');
    const filterInputs = filterForm.querySelectorAll('select');
    
    filterInputs.forEach(input => {
      input.addEventListener('change', function() {
        filterForm.submit();
      });
    });
  });
</script> 